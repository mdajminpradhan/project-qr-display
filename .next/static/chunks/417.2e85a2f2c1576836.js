"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[417],{22417:(e,t,a)=>{a.r(t),a.d(t,{default:()=>N});var s=a(95155),l=a(21455),r=a.n(l),n=a(28064),o=a(15255),i=a(12800),d=a(66963),c=a(27112),m=a(6215),h=a(67732),u=a(24138),v=a(28675),p=a(6020);let x=e=>{let{isOpen:t,setIsOpen:a}=e;return console.log("\uD83D\uDE80 ~ QRCodeModal ~ isOpen:",t),(0,s.jsx)(u.lG,{open:!!t,as:"div",className:"relative z-10 focus:outline-none",onClose:()=>a(null),__demoMode:!0,children:(0,s.jsx)("div",{className:"fixed inset-0 z-10 w-screen overflow-y-auto bg-black bg-opacity-50",children:(0,s.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,s.jsxs)(u.Lj,{transition:!0,className:"w-full max-w-md rounded-xl bg-white p-6 backdrop-blur-2xl duration-300 ease-out data-[closed]:transform-[scale(95%)] data-[closed]:opacity-0",children:[(0,s.jsx)(u.L3,{as:"h3",className:"text-xl text-center font-medium mb-10 border-b pb-2",children:"扫一扫查看详情"}),(0,s.jsx)(p.Ay,{size:256,style:{height:"auto",maxWidth:"100%",width:"100%"},value:JSON.stringify(t),viewBox:"0 0 256 256"}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(v.$,{className:"bg-amber-400 mt-5 rounded-lg w-full py-2.5 text-white",onClick:()=>a(null),children:"明白了，谢谢!"})})]})})})})};var f=a(12115),g=a(10142),j=a(92340),b=a.n(j),w=a(79995);let y=["#0088FE","#00C49F","#FFBB28","#FF8042","red","pink"],N=e=>{let{chartData:t}=e,[a,l]=(0,f.useState)(null),[u,v]=(0,f.useState)([]);(0,f.useEffect)(()=>{if(null==t?void 0:t.orangeData)try{let e=JSON.parse(t.orangeData),a=Object.entries(e).map(e=>{let[t,a]=e;return{name:t,value:parseFloat(a)}});v(a)}catch(e){console.error("Failed to parse orangeData:",e)}},[t]);let p=async()=>{if(!u||0===u.length){console.error("No data to download");return}let e=new g.jsPDF;e.setFontSize(16),e.text("Disease Analysis Report",14,20),e.setFontSize(12);let a=t.treeId?"Tree ID: ".concat(t.treeId):"No Tree ID",s=t.timestamp?new Date(t.timestamp).toLocaleString():"No date";e.text("".concat(a," - ").concat(s),14,30);let l={"Citrus leafminer":["1. Apply neem oil spray.","2. Remove and destroy infested leaves.","3. Use pheromone traps to monitor infestation."],Healthy:["1. Maintain proper watering.","2. Ensure good soil health.","3. Regularly inspect for pests or diseases."],"Red scale":["1. Use horticultural oil spray.","2. Introduce natural predators like ladybugs.","3. Prune heavily infested branches."]},r=u.reduce((e,t)=>t.value>e.value?t:e,{name:"",value:-1/0}),n=u.map(e=>{var t;let a=e.name===r.name?(null===(t=l[e.name])||void 0===t?void 0:t.join("\n"))||"No cure points available":"";return{Name:e.name,Value:e.value,Suggestions:a}});b()(e,{head:[["Disease Name","Value (%)","Treatment Suggestions"]],body:n.map(e=>[e.Name,e.Value.toFixed(2),e.Suggestions]),startY:40,styles:{fontSize:10,cellPadding:4,overflow:"linebreak"},columnStyles:{0:{cellWidth:50,textColor:"#0088FE",fillColor:"#E0F7FA"},1:{cellWidth:30,textColor:"#FF8042",fillColor:"#FFF3E0"},2:{cellWidth:80,textColor:"#FFBB28",fillColor:"#FFF9C4"}}});let o=n.map(e=>"Disease: ".concat(e.Name,"\nValue: ").concat(e.Value.toFixed(2),"%\nTreatment:\n").concat(e.Suggestions)).join("\n\n"),i=await w.toDataURL(o),d=e.internal.pageSize.height,c=(e.lastAutoTable.finalY||30)+20;c+60>d?(e.addPage(),e.text("Scan QR code for quick access:",14,20),e.addImage(i,"PNG",14,30,50,50)):(e.text("Scan QR code for quick access:",14,c),e.addImage(i,"PNG",14,c+10,50,50));let m=new Date().toISOString().replace(/[:.]/g,"-");e.save("disease-analysis-".concat(m,".pdf"))},j=Math.max(...u.map(e=>e.value));return(0,s.jsxs)("div",{className:"mt-5 border p-4 rounded-md bg-white",children:[(0,s.jsx)("div",{className:"flex justify-between items-center",children:(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:[t.timestamp?"日期和时间: ".concat(r()(t.timestamp).format("YYYY-MM-DD HH:mm:ss")):"No date and time was provided",t.treeId&&(0,s.jsxs)("span",{className:"ml-4",children:["树的标号: ",t.treeId]})]})}),(0,s.jsxs)(n.E,{width:500,height:300,data:u,margin:{top:20,right:30,left:20,bottom:5},children:[(0,s.jsx)(o.d,{strokeDasharray:"3 3",vertical:!1}),(0,s.jsx)(i.W,{dataKey:"name"}),(0,s.jsx)(d.h,{}),(0,s.jsx)(c.m,{}),(0,s.jsx)(m.y,{dataKey:"value",label:{position:"top"},children:null==u?void 0:u.map((e,t)=>(0,s.jsx)(h.f,{fill:e.value===j?"red":y[t%y.length]},"cell-".concat(t)))})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("button",{className:"mt-2 border border-amber-400 hover:bg-amber-400 hover:text-white w-full py-2 rounded-md flex justify-center items-center",onClick:()=>l(t),children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"size-6",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 3.75 9.375v-4.5ZM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 0 1-1.125-1.125v-4.5ZM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 13.5 9.375v-4.5Z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 6.75h.75v.75h-.75v-.75ZM6.75 16.5h.75v.75h-.75v-.75ZM16.5 6.75h.75v.75h-.75v-.75ZM13.5 13.5h.75v.75h-.75v-.75ZM13.5 19.5h.75v.75h-.75v-.75ZM19.5 13.5h.75v.75h-.75v-.75ZM19.5 19.5h.75v.75h-.75v-.75ZM16.5 16.5h.75v.75h-.75v-.75Z"})]}),"形成二维码"]}),(0,s.jsxs)("button",{className:"mt-2 border border-amber-400 hover:bg-amber-400 hover:text-white w-full py-2 rounded-md flex justify-center items-center",onClick:p,children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"size-5 mr-2.5",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})}),"下载报告"]})]}),(0,s.jsx)(x,{isOpen:a,setIsOpen:e=>l(e)})]})}}}]);